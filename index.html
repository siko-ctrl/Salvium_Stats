<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Salvium Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; object-src 'none';">
    <style>
        body {
            font-family: "Arial", sans-serif;
            background-color: #1a1a1a;
            color: #ffffff;
        }
        .content {
            padding: 20px;
        }
        .card {
            background-color: #4a4a4a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .highlight {
            color: #00ff00;
        }
    </style>
</head>
<body class="content">
    <div class="card">
        <p>Current Salvium Price</p>
        <h2 id="price">Loading...</h2>
        <p>Market Cap</p>
        <h2 id="marketCap">Loading...</h2>
    </div>
    <div class="card">
        <p>Block Height</p>
        <h2 id="blockHeight">Loading...</h2>
        <p>Network Hashrate</p>
        <h2 id="networkHash">Loading...</h2>
    </div>
    <div class="card">
        <p>Supply</p>
        <h2 id="supply">Loading...</h2>
        <p>Coins Burnt (last 30 days)</p>
        <h2 id="burnt">Loading...</h2>
    </div>

    <script>
        const apiUrl = "https://seed01.salvium.io:19081/json_rpc"; // Test direct API without proxy
        const liveCoinWatchUrl = "https://api.livecoinwatch.com/coins/single"; // Test direct API without proxy
        const liveCoinWatchApiKey = "b6807d61-488c-4ee3-a35e-5c08a12d314c";

        let circulatingSupply = 0;
        let price = 0;

        function calculateMarketCap() {
            if (circulatingSupply > 0 && price > 0) {
                const marketCap = circulatingSupply * price;
                document.getElementById("marketCap").textContent = `$${(marketCap / 1e6).toFixed(2)}M`;
            } else {
                document.getElementById("marketCap").textContent = "N/A";
            }
        }

        async function fetchNodeInfo() {
            try {
                const response = await axios.post(apiUrl, {
                    jsonrpc: "2.0",
                    id: "0",
                    method: "get_info",
                });

                const data = response.data.result;

                document.getElementById("blockHeight").textContent = data.height || "N/A";
                const hashrate = (data.difficulty / data.target) / 1e6;
                document.getElementById("networkHash").textContent = `${hashrate.toFixed(2)} MH/s`;
            } catch (error) {
                console.error("Error fetching node info:", error);
                document.getElementById("blockHeight").textContent = "Error";
                document.getElementById("networkHash").textContent = "Error";
            }
        }

        async function fetchSupplyInfo() {
            try {
                const response = await axios.post(apiUrl, {
                    jsonrpc: "2.0",
                    id: "0",
                    method: "get_supply_info",
                });

                const supplyData = response.data.result.supply_tally;

                const salSupply = supplyData.find((item) => item.currency_label === "SAL")?.amount || 0;
                const burntCoins = supplyData.find((item) => item.currency_label === "BURN")?.amount || 0;

                circulatingSupply = salSupply / 1e8;
                const burntAmount = burntCoins / 1e8;

                document.getElementById("supply").textContent = `${circulatingSupply.toFixed(2)} SAL`;
                document.getElementById("burnt").textContent = `${burntAmount.toFixed(2)} SAL`;
                calculateMarketCap();
            } catch (error) {
                console.error("Error fetching supply info:", error);
                document.getElementById("supply").textContent = "Error";
                document.getElementById("burnt").textContent = "Error";
            }
        }

        async function fetchPriceInfo() {
            try {
                const response = await axios.post(
                    liveCoinWatchUrl,
                    {
                        currency: "USD",
                        code: "__SAL", // Replace with Salvium code if needed
                        meta: true,
                    },
                    {
                        headers: {
                            "Content-Type": "application/json",
                            "x-api-key": liveCoinWatchApiKey,
                        },
                    }
                );

                const data = response.data;

                if (data && data.rate) {
                    price = data.rate;
                    document.getElementById("price").textContent = `$${data.rate.toFixed(4)}`;
                } else {
                    throw new Error("Price data missing.");
                }
                calculateMarketCap();
            } catch (error) {
                console.error("Error fetching price info:", error);
                document.getElementById("price").textContent = "Error";
                document.getElementById("marketCap").textContent = "Error";
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            fetchNodeInfo();
            fetchSupplyInfo();
            fetchPriceInfo();

            setInterval(() => {
                fetchNodeInfo();
                fetchSupplyInfo();
                fetchPriceInfo();
            }, 60000);
        });
    </script>
</body>
</html>
